---
import "../styles/global.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import SEO from "../components/SEO.astro";

interface SeoProps {
  title: string;
  description: string;
  url: string;
  image?: string;
  robots?: string;
  structuredData?: Record<string, unknown>;
}

interface Props {
  pageTitle: string;
  layout?: "default" | "post";
  seo?: SeoProps;
}

const { pageTitle, layout = "default", seo } = Astro.props;
---

<html lang="en">
  <head>
    <script is:inline>
      const theme = (() => {
        const stored = localStorage?.getItem("theme") ?? "";
        if (["dark", "light"].includes(stored)) return stored;
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) return "dark";
        return "dark";
      })();

      document.documentElement.classList.toggle("dark", theme !== "light");
      localStorage?.setItem("theme", theme);
    </script>
    <meta charset="utf-8" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßëüèæ‚Äçüíª</text></svg>"
    />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Anton&display=swap"
      rel="stylesheet"
    />
    {seo ? (
      <SEO
        title={seo.title}
        description={seo.description}
        url={seo.url}
        image={seo.image}
        robots={seo.robots}
        structuredData={seo.structuredData}
      />
    ) : (
      <title>{pageTitle}</title>
    )}
  </head>
  <body class="min-h-screen flex flex-col">
    <Header />
    <main class={`grow ${layout === "post" ? "post-layout" : ""}`}>
      <h1 class="my-4 text-4xl">{pageTitle}</h1>
      <slot />
    </main>
    <Footer />
    <script>
      import "../scripts/menu.js";
    </script>
    <!-- use is:inline directive to emit script here (don't hoist to page head) -->
    <script is:inline>
      document.addEventListener("click", function (e) {
        if (e.target instanceof Element && e.target.closest(".theme-toggle")) {
          document.documentElement.classList.toggle("dark");
          localStorage.setItem("theme", document.documentElement.classList.contains("dark") ? "dark" : "light");
        }
      });
    </script>
  </body>
</html>
