---
import BlogNav from "../components/BlogNav.astro";
import Tag from "../components/Tag.astro";
import { formatDate, SITE_URL } from "../consts";
import BaseLayout from "./BaseLayout.astro";

const { frontmatter } = Astro.props;

const canonicalUrl = new URL(Astro.url.pathname, SITE_URL).href;
const imageUrl = frontmatter.image.url.startsWith("http")
  ? frontmatter.image.url
  : new URL(frontmatter.image.url, SITE_URL).href;

const seo = {
  title: frontmatter.title,
  description: frontmatter.description,
  url: canonicalUrl,
  image: imageUrl,
  structuredData: {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: frontmatter.title,
    description: frontmatter.description,
    datePublished: frontmatter.pub_date.toISOString(),
    author: {
      "@type": "Person",
      name: frontmatter.author,
    },
    image: imageUrl,
  },
};
---

<BaseLayout pageTitle={frontmatter.title} layout="post" seo={seo}>
  <!--
    Workaround for View Transitions back-button bug on iOS Chrome/Edge (history replaced, back exits site).
    See: https://github.com/withastro/astro/issues/11919
  -->
  <div class="mb-4 md:hidden">
    <a
      href="/blog/"
      data-astro-prefetch
      class="inline-flex items-center gap-2 text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 font-semibold no-underline text-sm transition-colors"
      aria-label="Back to blog list"
    >
      <span aria-hidden="true">‚Üê</span>
      Back to Blogs
    </a>
  </div>
  <header class="pt-4 pb-6 border-b border-line-primary mb-6">
    <div class="flex flex-col gap-1 text-sm">
      <div class="flex items-baseline gap-2">
        <span class="text-line-primary tracking-widest">Published</span>
        <span class="text-accent font-medium"
          >{formatDate(frontmatter.pub_date)}</span
        >
      </div>
      {
        frontmatter.photo_date && (
          <div class="flex items-baseline gap-2">
            <span class="text-line-primary tracking-widest">Photos</span>
            <span class="text-accent font-medium">
              {formatDate(frontmatter.photo_date)}
            </span>
          </div>
        )
      }
    </div>
    <p class="text-lg italic mt-3 mb-2 opacity-90">{frontmatter.description}</p>
    <p class="text-sm text-line-primary m-0">By {frontmatter.author}</p>
    {
      frontmatter.tags && frontmatter.tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-4">
          {frontmatter.tags.map((tag: string) => (
            <Tag tag={tag} />
          ))}
        </div>
      )
    }
  </header>

  <slot />
  <BlogNav />
</BaseLayout>
