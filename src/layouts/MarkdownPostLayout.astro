---
import BlogNav from "../components/BlogNav.astro";
import Tag from "../components/Tag.astro";
import { formatDate, SITE_URL } from "../consts";
import BaseLayout from "./BaseLayout.astro";

const { frontmatter } = Astro.props;

const canonicalUrl = new URL(Astro.url.pathname, SITE_URL).href;
const imageUrl = frontmatter.image.url.startsWith("http")
  ? frontmatter.image.url
  : new URL(frontmatter.image.url, SITE_URL).href;

const seo = {
  title: frontmatter.title,
  description: frontmatter.description,
  url: canonicalUrl,
  image: imageUrl,
  structuredData: {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: frontmatter.title,
    description: frontmatter.description,
    datePublished: frontmatter.pub_date.toISOString(),
    author: {
      "@type": "Person",
      name: frontmatter.author,
    },
    image: imageUrl,
  },
};
---

<BaseLayout pageTitle={frontmatter.title} layout="post" seo={seo}>
  <header class="post-header">
    <div class="post-meta">
      <span class="post-meta-label">Published</span>
      <span class="post-meta-value">{formatDate(frontmatter.pub_date)}</span>
      {
        frontmatter.photo_date && (
          <span class="post-meta-group">
            <span class="post-meta-sep" aria-hidden="true">
              Â·
            </span>
            <span class="post-meta-label">Photos</span>
            <span class="post-meta-value">
              {formatDate(frontmatter.photo_date)}
            </span>
          </span>
        )
      }
    </div>
    <p class="post-description">{frontmatter.description}</p>
    <p class="post-byline">By {frontmatter.author}</p>
    {
      frontmatter.tags && frontmatter.tags.length > 0 && (
        <div class="post-tags">
          {frontmatter.tags.map((tag: string) => (
            <Tag tag={tag} />
          ))}
        </div>
      )
    }
  </header>

  <slot />
  <BlogNav />
</BaseLayout>
