---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import BlogPost from "../components/BlogPost.astro";
import Tag from "../components/Tag.astro";
import { SITE_URL } from "../consts";

const pageTitle = "Blog Posts";
const seo = {
  title: "Blog - Corey Damocles",
  description:
    "Articles on software development, film photography, and personal projects.",
  url: new URL(Astro.url.pathname, SITE_URL).href,
};
const allPosts = await getCollection("blog");

// Sort posts by pub_date (newest first)
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pub_date.getTime() - a.data.pub_date.getTime(),
);
---

<BaseLayout {pageTitle} seo={seo}>
  <BlogPost
    allPosts={sortedPosts.map((blog) => ({
      url: `/blogs/${blog.id}/`,
      frontmatter: {
        title: blog.data.title,
        author: blog.data.author,
        description: blog.data.description,
        pub_date: blog.data.pub_date,
        type: blog.data.type,
        image: blog.data.image,
        tags: blog.data.tags,
        photo_date: blog.data.photo_date,
      },
    }))}
  />

  <div class="border-t border-gray-200 my-4"></div>

  <Tag tag={"tags page"} link="tags" />
</BaseLayout>
