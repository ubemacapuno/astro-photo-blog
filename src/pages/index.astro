---
import BaseLayout from "../layouts/BaseLayout.astro";
import ImageCarousel from "../components/vue/ImageCarousel.vue";
import type { CarouselImage } from "../types";

const pageTitle = "";

function shuffleArray<T>(array: T[]): T[] {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

const baseCarouselImages: CarouselImage[] = [
  { src: "/images/hero-1.jpg", alt: "Hero image 1" },
  { src: "/images/hero-2.jpg", alt: "Hero image 2" },
  { src: "/images/hero-3.jpg", alt: "Hero image 3" },
  { src: "/images/hero-4.jpg", alt: "Hero image 4" },
  { src: "/images/hero-5.jpg", alt: "Hero image 5" },
  { src: "/images/hero-6.jpg", alt: "Hero image 6" },
  { src: "/images/hero-7.jpg", alt: "Hero image 7" },
  { src: "/images/hero-8.jpg", alt: "Hero image 8" },
  { src: "/images/hero-9.jpg", alt: "Hero image 9" },
];

const carouselImages = shuffleArray(baseCarouselImages);
---

<BaseLayout {pageTitle}>
  <section
    class="flex justify-center items-start min-h-[50vh] md:min-h-[60vh] whitespace-nowrap"
  >
    <div class="relative flex items-center justify-center">
      <div class="relative">
        <div id="carousel-wrapper" class="relative flex flex-col">
          <ImageCarousel client:load images={carouselImages} />
          <div
            id="fade-progress-bar"
            class="fade-progress-bar"
            hidden
            aria-hidden="true"
          >
          </div>
          <small
            id="shot-on-film-mobile"
            data-fade-group="hero-title"
            class="sm:hidden absolute top-full right-0 mt-2 font-serif text-base font-normal italic text-black dark:text-white normal-case tracking-tight transition-opacity duration-500"
          >
            Shot on Film
          </small>
        </div>
      </div>

      <div class="absolute z-10 flex flex-col items-center text-center">
        <span
          id="corey-damocles"
          data-fade-group="hero-title"
          class="block text-5xl sm:text-7xl md:text-8xl lg:text-8xl text-center font-bold text-red-600 uppercase whitespace-nowrap anton-regular tracking-wide cursor-pointer transition-opacity duration-1000"
        >
          Corey Damocles
        </span>
        <small
          id="shot-on-film-desktop"
          data-fade-group="hero-title"
          class="hidden sm:block self-end font-serif text-base font-normal italic text-black dark:text-white normal-case tracking-tight transition-opacity duration-1000"
        >
          Shot on Film
        </small>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const FADE_DURATION_MS = 9 * 3450; // can't import globals.ts here, so hardcode the value
  const FADE_GROUP = "hero-title";

  let isHidden = false;
  let restoreTimeout: ReturnType<typeof setTimeout> | null = null;

  const titleElements = document.querySelectorAll<HTMLElement>(
    `[data-fade-group="${FADE_GROUP}"]`,
  );
  const bar = document.getElementById("fade-progress-bar");

  const setTitleOpacity = (value: string) => {
    const hidden = value === "0";
    titleElements.forEach((el) => {
      el.style.opacity = value;
      el.style.pointerEvents = hidden ? "none" : "auto";
      el.setAttribute("aria-hidden", String(hidden));
    });
  };

  document.getElementById("corey-damocles")?.addEventListener("click", () => {
    if (isHidden || bar === null) return;
    if (restoreTimeout !== null) clearTimeout(restoreTimeout);

    isHidden = true;
    setTitleOpacity("0");

    bar.hidden = false;
    bar.setAttribute("aria-hidden", "false");
    bar.style.transitionDuration = `${FADE_DURATION_MS}ms`;
    bar.style.transform = "scaleX(1)";

    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        bar.style.transform = "scaleX(0)";
      });
    });

    restoreTimeout = setTimeout(() => {
      setTitleOpacity("1");
      isHidden = false;
      bar.hidden = true;
      bar.setAttribute("aria-hidden", "true");
      bar.style.transform = "scaleX(1)";
      restoreTimeout = null;
    }, FADE_DURATION_MS);
  });
</script>

<style>
  .fade-progress-bar {
    position: absolute;
    top: 100%;
    inset-inline: 0;
    height: 4px;
    background-color: #dc2626;
    transform-origin: center;
    transform: scaleX(1);
    transition: transform linear;
    pointer-events: none;
  }
</style>
