---
import BaseLayout from "../layouts/BaseLayout.astro";
import ImageCarousel from "../components/vue/ImageCarousel.vue";
import type { CarouselImage } from "../types";

const pageTitle = "";

function shuffleArray<T>(array: T[]): T[] {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

const baseCarouselImages: CarouselImage[] = [
  { src: "/images/hero-1.jpg", alt: "Hero image 1" },
  { src: "/images/hero-2.jpg", alt: "Hero image 2" },
  { src: "/images/hero-3.jpg", alt: "Hero image 3" },
  { src: "/images/hero-4.jpg", alt: "Hero image 4" },
  { src: "/images/hero-5.jpg", alt: "Hero image 5" },
  { src: "/images/hero-6.jpg", alt: "Hero image 6" },
  { src: "/images/hero-7.jpg", alt: "Hero image 7" },
  { src: "/images/hero-8.jpg", alt: "Hero image 8" },
  { src: "/images/hero-9.jpg", alt: "Hero image 9" },
];

const carouselImages = shuffleArray(baseCarouselImages);
---

<BaseLayout {pageTitle}>
  <section
    class="flex justify-center items-start min-h-[50vh] md:min-h-[60vh] whitespace-nowrap"
  >
    <div class="relative flex items-center justify-center">
      <div class="relative">
        <ImageCarousel client:load images={carouselImages} />
        <small
          id="shot-on-film-mobile"
          data-fade-group="hero-title"
          class="sm:hidden absolute top-full right-0 mt-2 font-serif text-base font-normal italic text-black dark:text-white normal-case tracking-tight transition-opacity duration-500"
        >
          Shot on Film
        </small>
      </div>

      <div class="absolute z-10 flex flex-col items-center text-center">
        <span
          id="corey-damocles"
          data-fade-group="hero-title"
          class="block text-5xl sm:text-7xl md:text-8xl lg:text-8xl text-center font-bold text-red-600 uppercase whitespace-nowrap anton-regular tracking-wide cursor-pointer transition-opacity duration-1000"
        >
          John DoeDoeDoe
        </span>
        <small
          id="shot-on-film-desktop"
          data-fade-group="hero-title"
          class="hidden sm:block self-end font-serif text-base font-normal italic text-black dark:text-white normal-case tracking-tight transition-opacity duration-1000"
        >
          Shot on Film
        </small>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const FADE_DURATION_MS = 9 * 3450; // can't import globals.ts here, so hardcode the value
  const FADE_GROUP = "hero-title";

  let isHidden = false;
  let restoreTimeout: string | number | NodeJS.Timeout | null | undefined =
    null;

  const elements = Array.from(
    document.querySelectorAll(`[data-fade-group="${FADE_GROUP}"]`),
  );

  const setOpacity = (value: string) => {
    const hidden = value === "0";
    elements.forEach((el) => {
      const htmlEl = el as HTMLElement;
      htmlEl.style.opacity = value;
      htmlEl.style.pointerEvents = hidden ? "none" : "auto";
      htmlEl.setAttribute("aria-hidden", String(hidden));
    });
  };

  const hideTemporarily = () => {
    if (isHidden) return;

    if (restoreTimeout !== null) {
      clearTimeout(restoreTimeout);
    }

    isHidden = true;
    setOpacity("0");

    restoreTimeout = setTimeout(() => {
      setOpacity("1");
      isHidden = false;
      restoreTimeout = null;
    }, FADE_DURATION_MS);
  };

  const trigger = document.getElementById("corey-damocles");
  trigger?.addEventListener("click", hideTemporarily);
</script>
